<app-header></app-header>

<ng-container *ngIf="user() as currentUser">
  <section class="wallet-page">
    <div class="balance-card">
      <div>
        <h1>Wallet balance</h1>
        <p>Your GameForge credits available to spend</p>
      </div>
      <span class="amount">{{ currentUser.walletBalance | number:'1.2-2' }} ฿</span>
    </div>

    <section class="topup-card">
      <h2>Recharge wallet</h2>
      <div class="options">
        <button
          type="button"
          *ngFor="let option of topUpOptions"
          [class.active]="selectedAmount() === option"
          (click)="selectAmount(option)"
        >
          {{ option | number:'1.0-0' }} ฿
        </button>
      </div>

      <label class="custom-input">
        <span>Custom amount</span>
        <input type="number" min="1" (input)="onCustomAmountChange($event.target.value)" />
      </label>

      <p class="success" *ngIf="successMessage()">{{ successMessage() }}</p>
      <p class="error" *ngIf="errorMessage()">{{ errorMessage() }}</p>

      <button type="button" class="topup" (click)="topUp()">Add funds</button>
    </section>

    <section class="history-card">
      <h2>Transaction history</h2>
      <table *ngIf="transactions.length; else emptyHistory">
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Details</th>
            <th class="amount">Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tx of transactions">
            <td>{{ tx.createdAt | date:'medium' }}</td>
            <td>{{ tx.type | titlecase }}</td>
            <td>
              <ng-container [ngSwitch]="tx.type">
                <span *ngSwitchCase="'topup'">Wallet top-up</span>
                <span *ngSwitchCase="'purchase'">
                  Purchased {{ tx.details?.gameIds?.length || 0 }} game(s)
                  <span *ngIf="tx.details?.discountCode">with code {{ tx.details?.discountCode }}</span>
                </span>
              </ng-container>
            </td>
            <td class="amount" [class.negative]="tx.type === 'purchase'">
              {{ tx.type === 'purchase' ? '-' : '+' }}{{ tx.amount | number:'1.2-2' }} ฿
            </td>
          </tr>
        </tbody>
      </table>
    </section>
  </section>
</ng-container>

<ng-template #emptyHistory>
  <p class="empty">No transactions yet.</p>
</ng-template>
